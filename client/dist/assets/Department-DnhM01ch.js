import{e as ue,r as o,R as te,C as ne,l as pe,f as G,h as he,o as fe,I as ge,_ as xe,b as ye,j as e,i as be}from"./index-CVZjuLi7.js";import{g as ve,a as Ce,b as je,d as we,c as Ne,u as Ie,e as Oe,f as Se}from"./departments-yp0Vf_LW.js";import{B as L,A as Ee,c as ke,M as Q,S as z,R as Pe,C as J}from"./index-BjrRxxmI.js";import{F as se}from"./Table-CdKyJk3D.js";import{g as Z,P as De,a as Te,A as ae,T as Le}from"./index-ClAXkO9a.js";import{R as _e}from"./UserOutlined-jxMFrRgL.js";import{F as j,I as A,R as Me}from"./index-CHBvb3cU.js";import{s as Fe}from"./index-CVfVAozb.js";import{R as $e}from"./EyeFilled-CDPxkBzk.js";import{u as Re,a as Ae,S as B}from"./index-D3eVkrds.js";import{R as ze}from"./DeleteFilled-DV3_mWzI.js";import{R as Be}from"./UserAddOutlined-Rvv8VHe_.js";import"./iconUtil-BCGkcafc.js";import"./Pagination-BWUH9pYp.js";const Ve=s=>{const{componentCls:r,iconCls:m,antCls:a,zIndexPopup:l,colorText:x,colorWarning:i,marginXXS:c,marginXS:p,fontSize:C,fontWeightStrong:N,colorTextHeading:y}=s;return{[r]:{zIndex:l,[`&${a}-popover`]:{fontSize:C},[`${r}-message`]:{marginBottom:p,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${r}-message-icon ${m}`]:{color:i,fontSize:C,lineHeight:1,marginInlineEnd:p},[`${r}-title`]:{fontWeight:N,color:y,"&:only-child":{fontWeight:"normal"}},[`${r}-description`]:{marginTop:c,color:x}},[`${r}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:p}}}}},We=s=>{const{zIndexPopupBase:r}=s;return{zIndexPopup:r+60}},oe=ue("Popconfirm",s=>Ve(s),We,{resetStyle:!1});var Xe=function(s,r){var m={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&r.indexOf(a)<0&&(m[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(s);l<a.length;l++)r.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(s,a[l])&&(m[a[l]]=s[a[l]]);return m};const re=s=>{const{prefixCls:r,okButtonProps:m,cancelButtonProps:a,title:l,description:x,cancelText:i,okText:c,okType:p="primary",icon:C=o.createElement(te,null),showCancel:N=!0,close:y,onConfirm:w,onCancel:O,onPopupClick:f}=s,{getPrefixCls:b}=o.useContext(ne),[d]=Re("Popconfirm",pe.Popconfirm),S=Z(l),E=Z(x);return o.createElement("div",{className:`${r}-inner-content`,onClick:f},o.createElement("div",{className:`${r}-message`},C&&o.createElement("span",{className:`${r}-message-icon`},C),o.createElement("div",{className:`${r}-message-text`},S&&o.createElement("div",{className:`${r}-title`},S),E&&o.createElement("div",{className:`${r}-description`},E))),o.createElement("div",{className:`${r}-buttons`},N&&o.createElement(L,Object.assign({onClick:O,size:"small"},a),i||(d==null?void 0:d.cancelText)),o.createElement(Ee,{buttonProps:Object.assign(Object.assign({size:"small"},ke(p)),m),actionFn:w,close:y,prefixCls:b("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},c||(d==null?void 0:d.okText))))},He=s=>{const{prefixCls:r,placement:m,className:a,style:l}=s,x=Xe(s,["prefixCls","placement","className","style"]),{getPrefixCls:i}=o.useContext(ne),c=i("popconfirm",r),[p]=oe(c);return p(o.createElement(De,{placement:m,className:G(c,a),style:l,content:o.createElement(re,Object.assign({prefixCls:c},x))}))};var Ue=function(s,r){var m={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&r.indexOf(a)<0&&(m[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(s);l<a.length;l++)r.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(s,a[l])&&(m[a[l]]=s[a[l]]);return m};const Ke=o.forwardRef((s,r)=>{var m,a;const{prefixCls:l,placement:x="top",trigger:i="click",okType:c="primary",icon:p=o.createElement(te,null),children:C,overlayClassName:N,onOpenChange:y,onVisibleChange:w,overlayStyle:O,styles:f,classNames:b}=s,d=Ue(s,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:S,className:E,style:V,classNames:M,styles:k}=he("popconfirm"),[W,X]=Ae(!1,{value:(m=s.open)!==null&&m!==void 0?m:s.visible,defaultValue:(a=s.defaultOpen)!==null&&a!==void 0?a:s.defaultVisible}),P=(h,g)=>{X(h,!0),w==null||w(h),y==null||y(h,g)},H=h=>{P(!1,h)},U=h=>{var g;return(g=s.onConfirm)===null||g===void 0?void 0:g.call(void 0,h)},F=h=>{var g;P(!1,h),(g=s.onCancel)===null||g===void 0||g.call(void 0,h)},K=(h,g)=>{const{disabled:q=!1}=s;q||P(h,g)},_=S("popconfirm",l),Y=G(_,E,N,M.root,b==null?void 0:b.root),$=G(M.body,b==null?void 0:b.body),[I]=oe(_);return I(o.createElement(Te,Object.assign({},fe(d,["title"]),{trigger:i,placement:x,onOpenChange:K,open:W,ref:r,classNames:{root:Y,body:$},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},k.root),V),O),f==null?void 0:f.root),body:Object.assign(Object.assign({},k.body),f==null?void 0:f.body)},content:o.createElement(re,Object.assign({okType:c,icon:p},s,{prefixCls:_,close:H,onConfirm:U,onCancel:F})),"data-popover-inject":!0}),C))}),le=Ke;le._InternalPanelDoNotUseOrYouWillBeFired=He;var Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"},qe=function(r,m){return o.createElement(ge,xe({},r,{ref:m,icon:Ye}))},Ge=o.forwardRef(qe);const Qe=({visible:s,onCancel:r,employees:m,loading:a})=>{const l=ye(),x=[{title:"Tên nhân viên",dataIndex:"fullName",key:"fullName",render:(i,c)=>e.jsxs(z,{children:[e.jsx(ae,{src:c==null?void 0:c.avatarUrl,icon:e.jsx(_e,{}),size:"large"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:c==null?void 0:c.fullName}),e.jsx("div",{style:{fontSize:"12px",color:"#888"},children:c.phoneNumber})]})]})},{title:"Email",dataIndex:["userId","email"],key:"userId.email"},{title:"Vị trí",dataIndex:["position","name"],key:"position.name"},{title:"Giới Tính",dataIndex:"gender",key:"gender",render:i=>{let c=i==="MALE"?"blue":i==="FEMALE"?"pink":"default",p=i==="MALE"?"Nam":i==="FEMALE"?"Nữ":"Khác";return e.jsx(Le,{color:c,children:p})}},{title:"Ngày Bắt Đầu",dataIndex:"hireDate",key:"hireDate",render:i=>be(i).format("DD/MM/YYYY"),sorter:(i,c)=>new Date(i.hireDate)-new Date(c.hireDate)}];return e.jsx(Q,{title:"Danh sách nhân viên",open:s,onCancel:r,footer:null,width:800,children:e.jsx(se,{columns:x,onRow:i=>({onClick:()=>l(`/dashboard/employee/${i._id}`)}),rowClassName:"cursor-pointer",dataSource:m,loading:a,rowKey:"_id",pagination:{pageSize:5}})})},{Option:ee}=B,ut=()=>{const[s,r]=o.useState([]),[m,a]=o.useState(!1),[l]=j.useForm(),[x]=j.useForm(),[i,c]=o.useState(null),[p,C]=o.useState(""),[N,y]=o.useState(!1),[w,O]=o.useState(!0),[f,b]=o.useState([]),[d,S]=Fe.useMessage(),[E,V]=o.useState(null),[M,k]=o.useState(!1),[W,X]=o.useState([]),[P,H]=o.useState(!0),[U,F]=o.useState(!1),[K,_]=o.useState([]),[Y,$]=o.useState(!1);o.useEffect(()=>{I()},[]);const I=async()=>{try{const[n,t]=await Promise.all([ve(),Ce()]);n.success?(O(!1),r(n.data),b(t.data)):O(!0)}catch{console.error("Failed to fetch departments")}},h=async()=>{var n;try{y(!0);const t=await l.validateFields();if(i){const u={name:i.name,description:i.description||"",roomNumber:i.roomNumber,managerId:((n=i.managerId)==null?void 0:n._id)||""},v={name:t.name,description:t.description||"",roomNumber:t.roomNumber,managerId:t.managerId||""};if(u.name===v.name&&u.description===v.description&&u.roomNumber===v.roomNumber&&u.managerId===v.managerId){d.info("Không có thay đổi để cập nhật."),a(!1),y(!1);return}(await Ie(i._id,t)).success?(d.success("Cập nhật phòng ban thành công"),a(!1),l.resetFields(),I()):d.error("Cập nhật phòng ban thất bại")}else(await Oe(t)).success?(d.success("Tạo phòng ban thành công"),a(!1),l.resetFields(),I()):d.error("Tạo phòng ban thất bại")}catch(t){console.error("Validation failed:",t),d.error("Xảy ra lỗi khi xử lý dữ liệu")}finally{y(!1)}},g=async n=>{try{(await we(n)).success?d.success("Xóa phòng ban thành công"):d.error("Xóa phòng ban thất bại"),I()}catch(t){console.error("Failed to delete department",t),d.error("Xảy ra lỗi khi xóa phòng ban")}},q=async()=>{try{const n=await x.validateFields();(await Se(E,n.employeeId)).success?(d.success("Gán nhân viên thành công"),k(!1),I()):d.error("Gán nhân viên thất bại")}catch(n){console.error("Failed to assign employee",n),d.error("Xảy ra lỗi khi gán nhân viên")}},ie=async n=>{V(n),k(!0);const t=await Ne(n);console.log(t),t.success?(X(t.data),H(!1)):d.error("Lấy danh sách nhân viên thất bại")},ce=async n=>{try{$(!0);const t=await je(n);t.success?(_(t.data),F(!0)):d.error("Không thể tải danh sách nhân viên")}catch(t){console.error("Failed to fetch department employees",t),d.error("Xảy ra lỗi khi tải danh sách nhân viên")}finally{$(!1)}},de=s==null?void 0:s.filter(n=>{var t,u;return((t=n==null?void 0:n.name)==null?void 0:t.toLowerCase().includes(p.toLowerCase()))||((u=n==null?void 0:n.roomNumber)==null?void 0:u.toLowerCase().includes(p.toLowerCase()))}),me=["#f56a00","#7265e6","#ffbf00","#00a2ae"];return e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-xl font-bold mb-3",children:"Quản lý phòng ban"}),e.jsxs(z,{style:{marginBottom:16},children:[e.jsx(A,{placeholder:"Tìm kiếm phòng ban theo tên, phòng",value:p,onChange:n=>C(n.target.value),style:{width:260}}),e.jsx(L,{type:"primary",className:"text-[#000]",onClick:()=>a(!0),children:"Thêm phòng ban"})]}),e.jsx(se,{dataSource:de,loading:w,rowKey:"_id",columns:[{title:"Tên phòng ban",dataIndex:"name",key:"name"},{title:"Phòng",dataIndex:"roomNumber",key:"roomNumber"},{title:"Quản lý",dataIndex:["manager","fullName"],key:"manager.fullName",render:(n,t)=>{var u,v,D,T;return e.jsx(e.Fragment,{children:t!=null&&t.managerId?e.jsxs(z,{children:[(u=t.managerId)!=null&&u.avatarUrl?e.jsx("img",{src:`${(v=t.managerId)==null?void 0:v.avatarUrl}`,width:39,height:39,style:{borderRadius:"100%"},onError:R=>{R.target.onerror=null,R.target.src="https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg"}}):e.jsx(ae,{style:{backgroundColor:me[Math.floor(Math.random()*4)],verticalAlign:"middle"},children:(D=t.managerId)==null?void 0:D.fullName.charAt(0)}),(T=t.managerId)==null?void 0:T.fullName]}):e.jsxs(e.Fragment,{children:[" ⚠️",e.jsx("b",{children:"Không có quản lý"})]})})}},{title:"Hành động",key:"actions",render:(n,t)=>e.jsxs(z,{children:[e.jsx(L,{type:"link",onClick:()=>ce(t._id),icon:e.jsx($e,{})}),e.jsx(L,{type:"link",icon:e.jsx(Ge,{}),onClick:()=>{var u;c(t),l.setFieldsValue({...t,managerId:(u=t==null?void 0:t.managerId)==null?void 0:u._id}),a(!0)}}),e.jsx(le,{title:"Are you sure you want to delete this department?",okText:"Yes, Delete",cancelText:"Cancel",okType:"danger",icon:e.jsx(Me,{style:{color:"red"}}),onConfirm:()=>g(t._id),children:e.jsx(L,{type:"link",danger:!0,icon:e.jsx(ze,{})})}),e.jsx(L,{type:"link",icon:e.jsx(Be,{}),onClick:()=>ie(t._id)})]})}]}),S,e.jsx(Q,{title:i?"Chỉnh sửa phòng ban":"Tạo mới phòng ban",open:m,onCancel:()=>{a(!1),c(null),l.resetFields()},onOk:h,confirmLoading:N,okButtonProps:{style:{backgroundColor:"#1890ff",borderColor:"#1890ff"}},children:e.jsxs(j,{form:l,layout:"vertical",children:[e.jsx(j.Item,{name:"name",label:"Tên phòng ban",rules:[{required:!0,message:"Please enter department name"}],children:e.jsx(A,{})}),e.jsx(j.Item,{name:"description",label:"Mô tả",children:e.jsx(A.TextArea,{})}),e.jsxs(Pe,{gutter:16,children:[e.jsx(J,{span:10,children:e.jsx(j.Item,{name:"roomNumber",label:"Phòng",rules:[{required:!0,message:"Please enter room"}],children:e.jsx(A,{})})}),e.jsx(J,{span:14,children:e.jsx(j.Item,{name:"managerId",label:"Quản lý",children:e.jsx(B,{placeholder:"Select manager",allowClear:!0,style:{width:"100%",minWidth:200},dropdownStyle:{maxHeight:400,overflow:"auto"},dropdownAlign:{offset:[0,10]},popupMatchSelectWidth:!1,showSearch:!0,filterOption:(n,t)=>{var D,T;const u=f.find(R=>R._id===t.value);if(!u)return!1;const v=n.toLowerCase();return((D=u.fullName)==null?void 0:D.toLowerCase().includes(v))||((T=u.roler)==null?void 0:T.toLowerCase().includes(v))},children:f==null?void 0:f.map(n=>e.jsx(ee,{value:n._id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:n==null?void 0:n.avatarUrl,alt:n.fullName,height:30,width:30,onError:t=>{t.target.onerror=null,t.target.src="https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg"}}),e.jsxs("span",{children:[n==null?void 0:n.fullName," - ",n==null?void 0:n.roler]})]})},n._id))})})})]})]})}),e.jsx(Q,{title:"Gán nhân viên vào phòng ban",open:M,onCancel:()=>k(!1),onOk:q,confirmLoading:P,okButtonProps:{style:{backgroundColor:"#1890ff",borderColor:"#1890ff"}},children:e.jsx(j,{form:x,layout:"vertical",children:e.jsx(j.Item,{name:"employeeId",label:"Chọn nhân viên",rules:[{required:!0,message:"Vui lòng chọn nhân viên"}],children:w?e.jsx(B,{loading:!0}):e.jsx(B,{placeholder:"Chọn nhân viên",showSearch:!0,mode:"multiple",loading:P,allowClear:!0,filterOption:(n,t)=>t.children.toLowerCase().includes(n.toLowerCase()),children:W.map(n=>e.jsx(ee,{value:n._id,children:n.fullName},n._id))})})})}),e.jsx(Qe,{visible:U,onCancel:()=>F(!1),employees:K,loading:Y})]})};export{ut as default};
