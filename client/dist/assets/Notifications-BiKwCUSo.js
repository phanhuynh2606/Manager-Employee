import{r as n,t as ne,D as _e,q as $t,H as ht,w as ar,E as Ft,ap as It,x as he,B as lr,K as Ze,_ as Wt,e as or,M as Bt,O as kt,C as sr,aq as ir,a9 as Dt,f as Mt,o as Yt,S as cr,X as ur,j as o,$ as Lt,ar as Pt,i as gt,as as dr,at as fr,au as hr,av as vr,aw as mr}from"./index-CVZjuLi7.js";import{g as pr,a as gr}from"./departments-yp0Vf_LW.js";import{S as zt,B as ut,a as Cr,M as Sr}from"./index-BjrRxxmI.js";import{c as Ct,a as yr,U as xr,T as br,i as Nr,g as Er,b as wr,S as Tr,R as dt,C as Ir}from"./iconUtil-BCGkcafc.js";import{x as kr,y as Dr,z as Mr,a as _t,B as Lr,q as Pr,A as _r,r as jr,C as Ar,F as Or,D as Rr,E as Vr,b as Kr,s as Hr,g as jt,G as $r,v as Fr,H as Wr,S as lt}from"./index-D3eVkrds.js";import{D as Br}from"./index-BxvyCBVr.js";import{F as We,I as At}from"./index-CHBvb3cU.js";import{T as Yr,C as zr}from"./index-DWbA25R3.js";import{P as Ur}from"./Pagination-BWUH9pYp.js";import{_ as qr}from"./createForOfIteratorHelper-DmAyqu7k.js";import{s as Be}from"./index-CVfVAozb.js";import"./PlusOutlined-C1amfU3h.js";import"./EditOutlined-B5RsWB_x.js";const Xr=function(e){var t=n.useRef({valueLabels:new Map});return n.useMemo(function(){var a=t.current.valueLabels,r=new Map,l=e.map(function(d){var i=d.value,c=d.label,u=c??a.get(i);return r.set(i,u),ne(ne({},d),{},{label:u})});return t.current.valueLabels=r,[l]},[e])};var Gr=function(t,a,r,l){return n.useMemo(function(){var d=function(b){return b.map(function(V){var K=V.value;return K})},i=d(t),c=d(a),u=i.filter(function(I){return!l[I]}),m=i,h=c;if(r){var M=Ct(i,!0,l);m=M.checkedKeys,h=M.halfCheckedKeys}return[Array.from(new Set([].concat(_e(u),_e(m)))),h]},[t,a,r,l])},Jr=function(t){return Array.isArray(t)?t:t!==void 0?[t]:[]},Zr=function(t){var a=t||{},r=a.label,l=a.value,d=a.children;return{_title:r?[r]:["title","label"],value:l||"value",key:l||"value",children:d||"children"}},St=function(t){return!t||t.disabled||t.disableCheckbox||t.checkable===!1},Qr=function(t,a){var r=[],l=function d(i){i.forEach(function(c){var u=c[a.children];u&&(r.push(c[a.value]),d(u))})};return l(t),r},Ot=function(t){return t==null};const en=function(e,t){return n.useMemo(function(){var a=yr(e,{fieldNames:t,initWrapper:function(l){return ne(ne({},l),{},{valueEntities:new Map})},processEntity:function(l,d){var i=l.node[t.value];d.valueEntities.set(i,l)}});return a},[e,t])};var xt=function(){return null},tn=["children","value"];function Ut(e){return kr(e).map(function(t){if(!n.isValidElement(t)||!t.type)return null;var a=t,r=a.key,l=a.props,d=l.children,i=l.value,c=$t(l,tn),u=ne({key:r,value:i},c),m=Ut(d);return m.length&&(u.children=m),u}).filter(function(t){return t})}function yt(e){if(!e)return e;var t=ne({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return ht(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function rn(e,t,a,r,l,d){var i=null,c=null;function u(){function m(h){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return h.map(function(b,V){var K="".concat(M,"-").concat(V),k=b[d.value],B=a.includes(k),ae=m(b[d.children]||[],K,B),Q=n.createElement(xt,b,ae.map(function($){return $.node}));if(t===k&&(i=Q),B){var ve={pos:K,node:Q,children:ae};return I||c.push(ve),ve}return null}).filter(function(b){return b})}c||(c=[],m(r),c.sort(function(h,M){var I=h.node.props.value,b=M.node.props.value,V=a.indexOf(I),K=a.indexOf(b);return V-K}))}Object.defineProperty(e,"triggerNode",{get:function(){return ht(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),u(),i}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return ht(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),u(),l?c:c.map(function(h){var M=h.node;return M})}})}var nn=function(t,a,r){var l=r.fieldNames,d=r.treeNodeFilterProp,i=r.filterTreeNode,c=l.children;return n.useMemo(function(){if(!a||i===!1)return t;var u=typeof i=="function"?i:function(h,M){return String(M[d]).toUpperCase().includes(a.toUpperCase())},m=function h(M){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return M.reduce(function(b,V){var K=V[c],k=I||u(a,yt(V)),B=h(K||[],k);return(k||B.length)&&b.push(ne(ne({},V),{},ar({isLeaf:void 0},c,B))),b},[])};return m(t)},[t,a,c,d,i])};function Rt(e){var t=n.useRef();t.current=e;var a=n.useCallback(function(){return t.current.apply(t,arguments)},[]);return a}function an(e,t){var a=t.id,r=t.pId,l=t.rootPId,d=new Map,i=[];return e.forEach(function(c){var u=c[a],m=ne(ne({},c),{},{key:c.key||u});d.set(u,m)}),d.forEach(function(c){var u=c[r],m=d.get(u);m?(m.children=m.children||[],m.children.push(c)):(u===l||l===null)&&i.push(c)}),i}function ln(e,t,a){return n.useMemo(function(){if(e){if(a){var r=ne({id:"id",pId:"pId",rootPId:null},Ft(a)==="object"?a:{});return an(e,r)}return e}return Ut(t)},[t,a,e])}var qt=n.createContext(null),Xt=n.createContext(null),on={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},sn=function(t,a){var r=Dr(),l=r.prefixCls,d=r.multiple,i=r.searchValue,c=r.toggleOpen,u=r.open,m=r.notFoundContent,h=n.useContext(Xt),M=h.virtual,I=h.listHeight,b=h.listItemHeight,V=h.listItemScrollOffset,K=h.treeData,k=h.fieldNames,B=h.onSelect,ae=h.dropdownMatchSelectWidth,Q=h.treeExpandAction,ve=h.treeTitleRender,$=h.onPopupScroll,D=h.leftMaxCount,Ne=h.leafCountOnly,F=h.valueEntities,N=n.useContext(qt),Y=N.checkable,L=N.checkedKeys,me=N.halfCheckedKeys,X=N.treeExpandedKeys,W=N.treeDefaultExpandAll,Ee=N.treeDefaultExpandedKeys,ie=N.onTreeExpand,ce=N.treeIcon,pe=N.showTreeIcon,ye=N.switcherIcon,we=N.treeLine,ue=N.treeNodeFilterProp,ge=N.loadData,ee=N.treeLoadedKeys,s=N.treeMotion,f=N.onTreeLoad,P=N.keyEntities,E=n.useRef(),z=It(function(){return K},[u,K],function(p,v){return v[0]&&p[1]!==v[1]}),le=n.useMemo(function(){return Y?{checked:L,halfChecked:me}:null},[Y,L,me]);n.useEffect(function(){if(u&&!d&&L.length){var p;(p=E.current)===null||p===void 0||p.scrollTo({key:L[0]})}},[u]);var _=function(v){v.preventDefault()},xe=function(v,O){var y=O.node;Y&&St(y)||(B(y.key,{selected:!L.includes(y.key)}),d||c(!1))},Ce=n.useState(Ee),je=he(Ce,2),Te=je[0],Ie=je[1],te=n.useState(null),Ae=he(te,2),Oe=Ae[0],Re=Ae[1],be=n.useMemo(function(){return X?_e(X):i?Oe:Te},[Te,Oe,X,i]),ke=function(v){Ie(v),Re(v),ie&&ie(v)},Ve=String(i).toLowerCase(),G=function(v){return Ve?String(v[ue]).toLowerCase().includes(Ve):!1};n.useEffect(function(){i&&Re(Qr(K,k))},[i]);var Ke=n.useState(function(){return new Map}),He=he(Ke,2),oe=He[0],Qe=He[1];n.useEffect(function(){D&&Qe(new Map)},[D]);function de(p){var v=p[k.value];if(!oe.has(v)){var O=F.get(v),y=(O.children||[]).length===0;if(y)oe.set(v,!1);else{var A=O.children.filter(function(q){return!q.node.disabled&&!q.node.disableCheckbox&&!L.includes(q.node[k.value])}),Z=A.length;oe.set(v,Z>D)}}return oe.get(v)}var j=lr(function(p){var v=p[k.value];return L.includes(v)||D===null?!1:D<=0?!0:Ne&&D?de(p):!1}),et=function p(v){var O=qr(v),y;try{for(O.s();!(y=O.n()).done;){var A=y.value;if(!(A.disabled||A.selectable===!1)){if(i){if(G(A))return A}else return A;if(A[k.children]){var Z=p(A[k.children]);if(Z)return Z}}}}catch(q){O.e(q)}finally{O.f()}return null},ze=n.useState(null),$e=he(ze,2),De=$e[0],Ue=$e[1],J=P[De];n.useEffect(function(){if(u){var p=null,v=function(){var y=et(z);return y?y[k.value]:null};!d&&L.length&&!i?p=L[0]:p=v(),Ue(p)}},[u,i]),n.useImperativeHandle(a,function(){var p;return{scrollTo:(p=E.current)===null||p===void 0?void 0:p.scrollTo,onKeyDown:function(O){var y,A=O.which;switch(A){case Ze.UP:case Ze.DOWN:case Ze.LEFT:case Ze.RIGHT:(y=E.current)===null||y===void 0||y.onKeyDown(O);break;case Ze.ENTER:{if(J){var Z=j(J.node),q=(J==null?void 0:J.node)||{},Xe=q.selectable,se=q.value,Me=q.disabled;Xe!==!1&&!Me&&!Z&&xe(null,{node:{key:De},selected:!L.includes(se)})}break}case Ze.ESC:c(!1)}},onKeyUp:function(){}}});var qe=It(function(){return!i},[i,X||Te],function(p,v){var O=he(p,1),y=O[0],A=he(v,2),Z=A[0],q=A[1];return y!==Z&&!!(Z||q)}),H=qe?ge:null;if(z.length===0)return n.createElement("div",{role:"listbox",className:"".concat(l,"-empty"),onMouseDown:_},m);var U={fieldNames:k};return ee&&(U.loadedKeys=ee),be&&(U.expandedKeys=be),n.createElement("div",{onMouseDown:_},J&&u&&n.createElement("span",{style:on,"aria-live":"assertive"},J.node.value),n.createElement(xr.Provider,{value:{nodeDisabled:j}},n.createElement(br,Wt({ref:E,focusable:!1,prefixCls:"".concat(l,"-tree"),treeData:z,height:I,itemHeight:b,itemScrollOffset:V,virtual:M!==!1&&ae!==!1,multiple:d,icon:ce,showIcon:pe,switcherIcon:ye,showLine:we,loadData:H,motion:s,activeKey:De,checkable:Y,checkStrictly:!0,checkedKeys:le,selectedKeys:Y?[]:L,defaultExpandAll:W,titleRender:ve},U,{onActiveChange:Ue,onSelect:xe,onCheck:xe,onExpand:ke,onLoad:f,filterTreeNode:G,expandAction:Q,onScroll:$}))))},cn=n.forwardRef(sn),bt="SHOW_ALL",Nt="SHOW_PARENT",vt="SHOW_CHILD";function Vt(e,t,a,r){var l=new Set(e);return t===vt?e.filter(function(d){var i=a[d];return!i||!i.children||!i.children.some(function(c){var u=c.node;return l.has(u[r.value])})||!i.children.every(function(c){var u=c.node;return St(u)||l.has(u[r.value])})}):t===Nt?e.filter(function(d){var i=a[d],c=i?i.parent:null;return!c||St(c.node)||!l.has(c.key)}):e}var un=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","maxCount","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"];function dn(e){return!e||Ft(e)!=="object"}var fn=n.forwardRef(function(e,t){var a=e.id,r=e.prefixCls,l=r===void 0?"rc-tree-select":r,d=e.value,i=e.defaultValue,c=e.onChange,u=e.onSelect,m=e.onDeselect,h=e.searchValue,M=e.inputValue,I=e.onSearch,b=e.autoClearSearchValue,V=b===void 0?!0:b,K=e.filterTreeNode,k=e.treeNodeFilterProp,B=k===void 0?"value":k,ae=e.showCheckedStrategy,Q=e.treeNodeLabelProp,ve=e.multiple,$=e.treeCheckable,D=e.treeCheckStrictly,Ne=e.labelInValue,F=e.maxCount,N=e.fieldNames,Y=e.treeDataSimpleMode,L=e.treeData,me=e.children,X=e.loadData,W=e.treeLoadedKeys,Ee=e.onTreeLoad,ie=e.treeDefaultExpandAll,ce=e.treeExpandedKeys,pe=e.treeDefaultExpandedKeys,ye=e.onTreeExpand,we=e.treeExpandAction,ue=e.virtual,ge=e.listHeight,ee=ge===void 0?200:ge,s=e.listItemHeight,f=s===void 0?20:s,P=e.listItemScrollOffset,E=P===void 0?0:P,z=e.onDropdownVisibleChange,le=e.dropdownMatchSelectWidth,_=le===void 0?!0:le,xe=e.treeLine,Ce=e.treeIcon,je=e.showTreeIcon,Te=e.switcherIcon,Ie=e.treeMotion,te=e.treeTitleRender,Ae=e.onPopupScroll,Oe=$t(e,un),Re=Mr(a),be=$&&!D,ke=$||D,Ve=D||Ne,G=ke||ve,Ke=_t(i,{value:d}),He=he(Ke,2),oe=He[0],Qe=He[1],de=n.useMemo(function(){return $?ae||vt:bt},[ae,$]),j=n.useMemo(function(){return Zr(N)},[JSON.stringify(N)]),et=_t("",{value:h!==void 0?h:M,postState:function(g){return g||""}}),ze=he(et,2),$e=ze[0],De=ze[1],Ue=function(g){De(g),I==null||I(g)},J=ln(L,me,Y),qe=en(J,j),H=qe.keyEntities,U=qe.valueEntities,p=n.useCallback(function(C){var g=[],S=[];return C.forEach(function(x){U.has(x)?S.push(x):g.push(x)}),{missingRawValues:g,existRawValues:S}},[U]),v=nn(J,$e,{fieldNames:j,treeNodeFilterProp:B,filterTreeNode:K}),O=n.useCallback(function(C){if(C){if(Q)return C[Q];for(var g=j._title,S=0;S<g.length;S+=1){var x=C[g[S]];if(x!==void 0)return x}}},[j,Q]),y=n.useCallback(function(C){var g=Jr(C);return g.map(function(S){return dn(S)?{value:S}:S})},[]),A=n.useCallback(function(C){var g=y(C);return g.map(function(S){var x=S.label,fe=S.value,R=S.halfChecked,w,T=U.get(fe);if(T){var re;x=te?te(T.node):(re=x)!==null&&re!==void 0?re:O(T.node),w=T.node.disabled}else if(x===void 0){var Le=y(oe).find(function(tt){return tt.value===fe});x=Le.label}return{label:x,value:fe,halfChecked:R,disabled:w}})},[U,O,y,oe]),Z=n.useMemo(function(){return y(oe===null?[]:oe)},[y,oe]),q=n.useMemo(function(){var C=[],g=[];return Z.forEach(function(S){S.halfChecked?g.push(S):C.push(S)}),[C,g]},[Z]),Xe=he(q,2),se=Xe[0],Me=Xe[1],Et=n.useMemo(function(){return se.map(function(C){return C.value})},[se]),Gt=Gr(se,Me,be,H),wt=he(Gt,2),Ge=wt[0],st=wt[1],Jt=n.useMemo(function(){var C=Vt(Ge,de,H,j),g=C.map(function(R){var w,T;return(w=(T=H[R])===null||T===void 0||(T=T.node)===null||T===void 0?void 0:T[j.value])!==null&&w!==void 0?w:R}),S=g.map(function(R){var w=se.find(function(re){return re.value===R}),T=Ne?w==null?void 0:w.label:te==null?void 0:te(w);return{value:R,label:T}}),x=A(S),fe=x[0];return!G&&fe&&Ot(fe.value)&&Ot(fe.label)?[]:x.map(function(R){var w;return ne(ne({},R),{},{label:(w=R.label)!==null&&w!==void 0?w:R.value})})},[j,G,Ge,se,A,de,H]),Zt=Xr(Jt),Qt=he(Zt,1),mt=Qt[0],Tt=n.useMemo(function(){return G&&(de==="SHOW_CHILD"||D||!$)?F:null},[F,G,D,de,$]),it=Rt(function(C,g,S){var x=Vt(C,de,H,j);if(!(Tt&&x.length>Tt)){var fe=A(C);if(Qe(fe),V&&De(""),c){var R=C;be&&(R=x.map(function(Se){var Pe=U.get(Se);return Pe?Pe.node[j.value]:Se}));var w=g||{triggerValue:void 0,selected:void 0},T=w.triggerValue,re=w.selected,Le=R;if(D){var tt=Me.filter(function(Se){return!R.includes(Se.value)});Le=[].concat(_e(Le),_e(tt))}var rt=A(Le),Fe={preValue:se,triggerValue:T},Je=!0;(D||S==="selection"&&!re)&&(Je=!1),rn(Fe,T,C,J,Je,j),ke?Fe.checked=re:Fe.selected=re;var ct=Ve?rt:rt.map(function(Se){return Se.value});c(G?ct:ct[0],Ve?null:rt.map(function(Se){return Se.label}),Fe)}}}),pt=n.useCallback(function(C,g){var S,x=g.selected,fe=g.source,R=H[C],w=R==null?void 0:R.node,T=(S=w==null?void 0:w[j.value])!==null&&S!==void 0?S:C;if(!G)it([T],{selected:!0,triggerValue:T},"option");else{var re=x?[].concat(_e(Et),[T]):Ge.filter(function(Pe){return Pe!==T});if(be){var Le=p(re),tt=Le.missingRawValues,rt=Le.existRawValues,Fe=rt.map(function(Pe){return U.get(Pe).key}),Je;if(x){var ct=Ct(Fe,!0,H);Je=ct.checkedKeys}else{var Se=Ct(Fe,{halfCheckedKeys:st},H);Je=Se.checkedKeys}re=[].concat(_e(tt),_e(Je.map(function(Pe){return H[Pe].node[j.value]})))}it(re,{selected:x,triggerValue:T},fe||"option")}x||!G?u==null||u(T,yt(w)):m==null||m(T,yt(w))},[p,U,H,j,G,Et,it,be,u,m,Ge,st,F]),er=n.useCallback(function(C){if(z){var g={};Object.defineProperty(g,"documentClickClose",{get:function(){return ht(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),z(C,g)}},[z]),tr=Rt(function(C,g){var S=C.map(function(x){return x.value});if(g.type==="clear"){it(S,{},"selection");return}g.values.length&&pt(g.values[0].value,{selected:!1,source:"selection"})}),rr=n.useMemo(function(){return{virtual:ue,dropdownMatchSelectWidth:_,listHeight:ee,listItemHeight:f,listItemScrollOffset:E,treeData:v,fieldNames:j,onSelect:pt,treeExpandAction:we,treeTitleRender:te,onPopupScroll:Ae,leftMaxCount:F===void 0?null:F-mt.length,leafCountOnly:de==="SHOW_CHILD"&&!D&&!!$,valueEntities:U}},[ue,_,ee,f,E,v,j,pt,we,te,Ae,F,mt.length,de,D,$,U]),nr=n.useMemo(function(){return{checkable:ke,loadData:X,treeLoadedKeys:W,onTreeLoad:Ee,checkedKeys:Ge,halfCheckedKeys:st,treeDefaultExpandAll:ie,treeExpandedKeys:ce,treeDefaultExpandedKeys:pe,onTreeExpand:ye,treeIcon:Ce,treeMotion:Ie,showTreeIcon:je,switcherIcon:Te,treeLine:xe,treeNodeFilterProp:B,keyEntities:H}},[ke,X,W,Ee,Ge,st,ie,ce,pe,ye,Ce,Ie,je,Te,xe,B,H]);return n.createElement(Xt.Provider,{value:rr},n.createElement(qt.Provider,{value:nr},n.createElement(Lr,Wt({ref:t},Oe,{id:Re,prefixCls:l,mode:G?"multiple":void 0,displayValues:mt,onDisplayValuesChange:tr,searchValue:$e,onSearch:Ue,OptionList:cn,emptyOptions:!J.length,onDropdownVisibleChange:er,dropdownMatchSelectWidth:_}))))}),ot=fn;ot.TreeNode=xt;ot.SHOW_ALL=bt;ot.SHOW_PARENT=Nt;ot.SHOW_CHILD=vt;const hn=e=>{const{componentCls:t,treePrefixCls:a,colorBgElevated:r}=e,l=`.${a}`;return[{[`${t}-dropdown`]:[{padding:`${kt(e.paddingXS)} ${kt(e.calc(e.paddingXS).div(2).equal())}`},Er(a,Bt(e,{colorBgContainer:r})),{[l]:{borderRadius:0,[`${l}-list-holder-inner`]:{alignItems:"stretch",[`${l}-treenode`]:{[`${l}-node-content-wrapper`]:{flex:"auto"}}}}},wr(`${a}-checkbox`,e),{"&-rtl":{direction:"rtl",[`${l}-switcher${l}-switcher_close`]:{[`${l}-switcher-icon svg`]:{transform:"rotate(90deg)"}}}}]}]};function vn(e,t,a){return or("TreeSelect",r=>{const l=Bt(r,{treePrefixCls:t});return[hn(l)]},Nr)(e,a)}var mn=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,r=Object.getOwnPropertySymbols(e);l<r.length;l++)t.indexOf(r[l])<0&&Object.prototype.propertyIsEnumerable.call(e,r[l])&&(a[r[l]]=e[r[l]]);return a};const pn=(e,t)=>{var a;const{prefixCls:r,size:l,disabled:d,bordered:i=!0,className:c,rootClassName:u,treeCheckable:m,multiple:h,listHeight:M=256,listItemHeight:I,placement:b,notFoundContent:V,switcherIcon:K,treeLine:k,getPopupContainer:B,popupClassName:ae,dropdownClassName:Q,treeIcon:ve=!1,transitionName:$,choiceTransitionName:D="",status:Ne,treeExpandAction:F,builtinPlacements:N,dropdownMatchSelectWidth:Y,popupMatchSelectWidth:L,allowClear:me,variant:X,dropdownStyle:W,tagRender:Ee,maxCount:ie,showCheckedStrategy:ce,treeCheckStrictly:pe}=e,ye=mn(e,["prefixCls","size","disabled","bordered","className","rootClassName","treeCheckable","multiple","listHeight","listItemHeight","placement","notFoundContent","switcherIcon","treeLine","getPopupContainer","popupClassName","dropdownClassName","treeIcon","transitionName","choiceTransitionName","status","treeExpandAction","builtinPlacements","dropdownMatchSelectWidth","popupMatchSelectWidth","allowClear","variant","dropdownStyle","tagRender","maxCount","showCheckedStrategy","treeCheckStrictly"]),{getPopupContainer:we,getPrefixCls:ue,renderEmpty:ge,direction:ee,virtual:s,popupMatchSelectWidth:f,popupOverflow:P}=n.useContext(sr),[,E]=ir(),z=I??(E==null?void 0:E.controlHeightSM)+(E==null?void 0:E.paddingXXS),le=ue(),_=ue("select",r),xe=ue("select-tree",r),Ce=ue("tree-select",r),{compactSize:je,compactItemClassnames:Te}=Pr(_,ee),Ie=Dt(_),te=Dt(Ce),[Ae,Oe,Re]=_r(_,Ie),[be]=vn(Ce,xe,te),[ke,Ve]=jr("treeSelect",X,i),G=Mt(ae||Q,`${Ce}-dropdown`,{[`${Ce}-dropdown-rtl`]:ee==="rtl"},u,Re,Ie,te,Oe),Ke=!!(m||h),He=n.useMemo(()=>{if(!(ie&&(ce==="SHOW_ALL"&&!pe||ce==="SHOW_PARENT")))return ie},[ie,ce,pe]),oe=Ar(e.suffixIcon,e.showArrow),Qe=(a=L??Y)!==null&&a!==void 0?a:f,{status:de,hasFeedback:j,isFormItemInput:et,feedbackIcon:ze}=n.useContext(Or),$e=Fr(de,Ne),{suffixIcon:De,removeIcon:Ue,clearIcon:J}=Rr(Object.assign(Object.assign({},ye),{multiple:Ke,showSuffixIcon:oe,hasFeedback:j,feedbackIcon:ze,prefixCls:_,componentName:"TreeSelect"})),qe=me===!0?{clearIcon:J}:me;let H;V!==void 0?H=V:H=(ge==null?void 0:ge("Select"))||n.createElement(Vr,{componentName:"Select"});const U=Yt(ye,["suffixIcon","removeIcon","clearIcon","itemIcon","switcherIcon"]),p=n.useMemo(()=>b!==void 0?b:ee==="rtl"?"bottomRight":"bottomLeft",[b,ee]),v=Kr(se=>{var Me;return(Me=l??je)!==null&&Me!==void 0?Me:se}),O=n.useContext(cr),y=d??O,A=Mt(!r&&Ce,{[`${_}-lg`]:v==="large",[`${_}-sm`]:v==="small",[`${_}-rtl`]:ee==="rtl",[`${_}-${ke}`]:Ve,[`${_}-in-form-item`]:et},Hr(_,$e,j),Te,c,u,Re,Ie,te,Oe),Z=se=>n.createElement(Tr,{prefixCls:xe,switcherIcon:K,treeNodeProps:se,showLine:k}),[q]=ur("SelectLike",W==null?void 0:W.zIndex),Xe=n.createElement(ot,Object.assign({virtual:s,disabled:y},U,{dropdownMatchSelectWidth:Qe,builtinPlacements:$r(N,P),ref:t,prefixCls:_,className:A,listHeight:M,listItemHeight:z,treeCheckable:m&&n.createElement("span",{className:`${_}-tree-checkbox-inner`}),treeLine:!!k,suffixIcon:De,multiple:Ke,placement:p,removeIcon:Ue,allowClear:qe,switcherIcon:Z,showTreeIcon:ve,notFoundContent:H,getPopupContainer:B||we,treeMotion:null,dropdownClassName:G,dropdownStyle:Object.assign(Object.assign({},W),{zIndex:q}),choiceTransitionName:jt(le,"",D),transitionName:jt(le,"slide-up",$),treeExpandAction:F,tagRender:Ke?Ee:void 0,maxCount:He,showCheckedStrategy:ce,treeCheckStrictly:pe}));return Ae(be(Xe))},gn=n.forwardRef(pn),Ye=gn,Cn=Wr(Ye,"dropdownAlign",e=>Yt(e,["visible"]));Ye.TreeNode=xt;Ye.SHOW_ALL=bt;Ye.SHOW_PARENT=Nt;Ye.SHOW_CHILD=vt;Ye._InternalPanelDoNotUseOrYouWillBeFired=Cn;const Kt=e=>{const t={},a=[];return e.forEach(r=>{const l=r.departmentId._id;t[l]||(t[l]={value:l,title:r.departmentId.name,children:[]},a.push(t[l]))}),e.forEach(r=>{var d,i;const l=r.departmentId._id;t[l].children.push({value:r._id,title:`${r.fullName}${(d=r==null?void 0:r.roler)!=null&&d.startsWith("Trưởng")?" - Trưởng phòng":""}`,email:((i=r.userId)==null?void 0:i.email)||"No email",position:r.position,roler:r.roler,avatarUrl:r.avatarUrl||"/assets/images/avatar-default.png"})}),a},{RangePicker:Sn}=Br,{Option:ft}=lt,yn=e=>{const{filter:t,setFilter:a,selectedType:r,setSelectedType:l,setDateRange:d}=e,i=u=>{l(u)},c=u=>{d(u||[])};return o.jsx(o.Fragment,{children:o.jsxs(zt,{children:[o.jsxs(dt.Group,{value:t,onChange:u=>a(u.target.value),children:[o.jsx(dt.Button,{value:"ALL",children:"Tất cả"}),o.jsx(dt.Button,{value:"READ",children:"Đã đọc"}),o.jsx(dt.Button,{value:"UNREAD",children:"Chưa đọc"})]}),o.jsxs(lt,{value:r,onChange:i,placeholder:"Chọn loại thông báo",className:"w-[180px]",children:[o.jsx(ft,{value:"ALL",children:"Tất cả"}),o.jsx(ft,{value:"SYSTEM",children:"Hệ thống"}),o.jsx(ft,{value:"DEPARTMENT",children:"Phòng ban"}),o.jsx(ft,{value:"PERSONAL",children:"Cá nhân"})]}),o.jsx(Sn,{onChange:c})]})})},{Title:Ht,Text:nt}=Yr,{Option:at}=lt;function jn(){const[e,t]=n.useState([]),[a,r]=n.useState("ALL"),[l,d]=n.useState(!1),[i]=We.useForm(),{user:c}=Lt(s=>s.auth),[u,m]=n.useState([]),[h,M]=n.useState("SYSTEM"),[I,b]=n.useState(!1),[V,K]=n.useState([]),[k,B]=n.useState(1),[ae,Q]=n.useState(0),[ve,$]=n.useState(!1),[D,Ne]=n.useState("ALL"),[F,N]=n.useState([]),[Y,L]=n.useState([]),me=10,{employeeId:X}=Lt(s=>s.auth.user),W=async(s=1)=>{try{$(!0);const f=F.length?gt(F[0]).format("YYYY-MM-DD"):"",P=F.length?gt(F[1]).format("YYYY-MM-DD"):"",E=await dr(s,me,a,D,f,P);E.success&&(t(E.data),Q(a==="ALL"?E.totalNotifications:a==="READ"?E.readNotifications:E.unreadNotifications))}catch(f){console.error("Error fetching notifications:",f)}finally{$(!1)}};n.useEffect(()=>{W()},[a,D,F]),n.useEffect(()=>{if(!X)return;const s=f=>{t(P=>[f,...P]),Q(P=>P+1)};return Pt.on("newNotification",s),()=>{console.log("Cleaning up socket listeners in Notifications"),Pt.off("newNotification",s)}},[]);const Ee=async s=>{try{const f=await fr(s);f.success?Be.success("Đã đánh dấu là đã đọc"):Be.error(f.message),W()}catch(f){console.error("Error marking notification as read:",f)}},ie=async()=>{const s=await pr();console.log(s),s.success&&m(s.data),d(!0)},ce=async()=>{try{const s=await i.validateFields(),f=await hr(s);f.success?Be.success("Tạo thông báo thành công!"):Be.error(f.message),i.resetFields(),M("SYSTEM"),d(!1),W()}catch(s){console.error("Error creating notification:",s)}},pe=()=>{d(!1)},ye=async s=>{if(M(s),b(!0),s==="PERSONAL"){const f=await gr();f.success&&(b(!1),Kt(f.data)&&K(Kt(f.data)))}s!=="DEPARTMENT"&&i.setFieldsValue({departmentId:void 0}),s!=="PERSONAL"&&i.setFieldsValue({recipientId:void 0})},we=s=>{s.includes("ALL")&&i.setFieldsValue({departmentId:["ALL"]})},ue=s=>{B(s),W(s)},ge=async s=>{try{const f=Y.filter(E=>{const z=e.find(le=>le._id===E);return!(z!=null&&z.readBy.includes(X))});if(f.length===0){Be.info("Tất cả thông báo đã được đọc.");return}const P=await vr(f);console.log(P),P.success&&(Be.success("Đã đánh dấu là đã đọc"),L([]),W())}catch(f){console.error("Error marking notifications as read:",f)}},ee=async s=>{try{(await mr(Y)).success&&(Be.success("Đã xóa thông báo"),L([]),W())}catch(f){console.error("Error deleting notifications:",f)}};return o.jsxs("div",{className:"mx-auto p-3",children:[o.jsx(Ht,{level:2,className:"mb-4",children:"Thông báo"}),o.jsxs("div",{className:"flex justify-between align-center pr-10",children:[o.jsx("div",{className:"mb-4",children:o.jsx(yn,{filter:a,setFilter:r,selectedType:D,setSelectedType:Ne,dateRange:F,setDateRange:N})}),(c==null?void 0:c.role)==="ADMIN"&&o.jsx(ut,{type:"primary",onClick:ie,className:"bg-blue-500",children:"Tạo thông báo"})]}),o.jsxs(zt,{direction:"horizontal",className:"w-full mb-3 ml-7",children:[a!=="READ"&&o.jsx(ut,{className:"bg-blue-500",type:"primary",disabled:Y.every(s=>{const f=e.find(P=>P._id===s);return f==null?void 0:f.readBy.includes(X)}),onClick:()=>ge(),children:"Đánh dấu đã đọc"}),o.jsx(ut,{danger:!0,disabled:Y.length===0,onClick:async()=>ee(),children:"Xóa"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"space-y-2",children:ve?o.jsx(Cr,{active:!0}):o.jsxs(o.Fragment,{children:[e.length===0&&o.jsxs(nt,{type:"secondary",className:"text-[20px]",children:["Chưa có thông báo nào ",a==="ALL"?"":a==="READ"?"đã đọc":"chưa dọc"]}),e==null?void 0:e.map(s=>{var P;const f=s.readBy.includes(X);return o.jsxs("div",{className:"flex justify-between items-center gap-3",children:[o.jsx("div",{className:"items-center",children:o.jsx(Ir,{checked:Y.includes(s._id),onChange:E=>{const z=E.target.checked;L(le=>z?[...le,s._id]:le.filter(_=>_!==s._id))}})}),o.jsx("div",{className:"w-full",children:o.jsxs(zr,{className:`shadow-md ${f?"bg-gray-100 border-l-4":"bg-blue-100 border-l-4 border-blue-500"}`,children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx(Ht,{level:4,className:"mb-1",children:s.title}),o.jsx(nt,{className:"text-gray-500 text-[16px]",children:gt(s.createdAt).format("DD/MM/YYYY HH:mm")})]}),o.jsx(nt,{className:"block mb-1",children:s.content}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs(nt,{type:"secondary",children:[o.jsx("strong",{children:"Loại:"})," ",s.type==="SYSTEM"?"Hệ thống":s.type==="DEPARTMENT"?"Phòng ban":"Cá nhân"]}),o.jsxs(nt,{type:"secondary",children:[o.jsx("strong",{children:"Người gửi:"})," ",((P=s==null?void 0:s.createdBy)==null?void 0:P.fullName)||"Không rõ"]})]}),!f&&o.jsx(ut,{onClick:()=>Ee(s._id),className:"mt-2 text-blue-500 border-none",children:"Đánh dấu là đã đọc"})]},s._id)})]},s._id)})]})}),ae>0&&o.jsx("div",{className:"flex justify-center mt-4",children:o.jsx(Ur,{current:k,pageSize:me,total:ae,onChange:ue})})]}),o.jsx(Sr,{title:"Tạo Thông Báo",open:l,onOk:ce,onCancel:pe,okText:"Gửi",cancelText:"Hủy",okButtonProps:{style:{backgroundColor:"#1890ff",borderColor:"#1890ff"}},children:o.jsxs(We,{form:i,layout:"vertical",children:[o.jsx(We.Item,{name:"title",label:"Tiêu đề",rules:[{required:!0,message:"Vui lòng nhập tiêu đề!"}],children:o.jsx(At,{placeholder:"Nhập tiêu đề"})}),o.jsx(We.Item,{name:"content",label:"Nội dung",rules:[{required:!0,message:"Vui lòng nhập nội dung!"}],children:o.jsx(At.TextArea,{rows:2,placeholder:"Nhập nội dung"})}),o.jsx(We.Item,{name:"type",label:"Loại Thông Báo",rules:[{required:!0,message:"Vui lòng chọn loại thông báo!"}],initialValue:"SYSTEM",children:o.jsxs(lt,{placeholder:"Chọn loại thông báo",onChange:ye,children:[o.jsx(at,{value:"SYSTEM",children:"Hệ thống"}),o.jsx(at,{value:"DEPARTMENT",children:"Phòng ban"}),o.jsx(at,{value:"PERSONAL",children:"Cá nhân"})]})}),h==="DEPARTMENT"&&o.jsx(We.Item,{name:"departmentId",label:"Phòng Ban",children:o.jsxs(lt,{placeholder:"Chọn phòng ban",allowClear:!0,mode:"multiple",onChange:we,children:[o.jsx(at,{value:"ALL",children:"Tất cả"}),u.map(s=>o.jsx(at,{value:s._id,children:s.name},s._id))]})}),h==="PERSONAL"&&o.jsx(We.Item,{name:"recipientId",label:"Nhân viên",children:o.jsx(Ye,{treeData:V,placeholder:I?"Đang tải dữ liệu...":"Chọn nhân viên gửi thông báo",allowClear:!0,multiple:!0,showSearch:!0,treeCheckable:!0,filterTreeNode:(s,f)=>f.title.toLowerCase().includes(s.toLowerCase()),disabled:I,loading:I})})]})})]})}export{jn as default};
