import{r as x,I as M,_ as E,j as e,a0 as q,i as C,$ as F}from"./index-CVZjuLi7.js";import{g as z,u as A,a as H}from"./salaries-C-KzLwir.js";import{D as $,F as O}from"./Table-CdKyJk3D.js";import{R as V}from"./EditOutlined-B5RsWB_x.js";import{A as B,T as _}from"./index-ClAXkO9a.js";import{R as U}from"./UserOutlined-jxMFrRgL.js";import{T as X,M as Y,B as N,S as P}from"./index-BjrRxxmI.js";import{F as r,I as h}from"./index-CHBvb3cU.js";import{D as T}from"./index-BxvyCBVr.js";import{R as D}from"./PlusOutlined-C1amfU3h.js";import{R}from"./DeleteOutlined-Bl3nP3f5.js";import{s as L}from"./index-CVfVAozb.js";import{R as G,S as v}from"./index-D3eVkrds.js";import"./iconUtil-BCGkcafc.js";import"./Pagination-BWUH9pYp.js";var K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},J=function(j,f){return x.createElement(M,E({},j,{ref:f,icon:K}))},Q=x.forwardRef(J),W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"}}]},name:"read",theme:"outlined"},Z=function(j,f){return x.createElement(M,E({},j,{ref:f,icon:W}))},ee=x.forwardRef(Z);const se=(t,j,f)=>[{title:"Hành động",key:"action",dataIndex:"_id",fixed:"left",width:120,render:a=>e.jsx($,{menu:{items:[{key:"1",label:e.jsxs(q,{className:"flex items-center gap-2 w-full",to:`/dashboard/salaries/${a}`,children:[e.jsx(ee,{}),e.jsx("span",{className:"font-semibold",children:"Xem chi tiết"})]})},f==="ADMIN"&&{key:"2",label:e.jsxs("div",{className:"flex items-center gap-2 w-full",onClick:async()=>{try{const l=await z(a);t(l.data),j(!0)}catch(l){console.error("Error fetching salary details:",l)}},children:[e.jsx(V,{}),e.jsx("span",{className:"font-semibold cursor-pointer",children:"Cập nhật"})]})}]},trigger:["click"],children:e.jsx(Q,{className:"cursor-pointer text-lg"})})},{title:"Nhân viên",dataIndex:"employeeId",key:"employeeId",render:a=>{var l;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{src:`http://localhost:4000/assets/images/${(l=a==null?void 0:a.employeeId)==null?void 0:l.avatarUrl}`,icon:e.jsx(U,{}),size:"large"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-semibold",children:a.fullName}),e.jsx(_,{color:"blue",className:"w-fit",children:a.position})]})]})}},{title:"Năm",dataIndex:"year",key:"year",align:"center"},{title:"Tháng",dataIndex:"month",key:"month",align:"center"},{title:"Lương cơ bản",dataIndex:"baseSalary",key:"baseSalary",align:"right",render:a=>`${a.toLocaleString()}đ`},{title:"Phụ cấp",dataIndex:"allowances",key:"allowances",render:a=>a.length>0?e.jsx("div",{className:"flex flex-col gap-1 bg-gray-50 p-2 rounded-md",children:a.map((l,b)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:l.name}),e.jsxs("span",{className:"text-blue-600",children:[l.amount.toLocaleString(),"đ"]})]},b))}):e.jsx("span",{className:"text-gray-500",children:"-"})},{title:"Tiền thưởng",dataIndex:"bonuses",key:"bonuses",render:a=>a.length>0?e.jsx("div",{className:"flex flex-col gap-1 bg-gray-50 p-2 rounded-md",children:a.map((l,b)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:l.name}),e.jsxs("span",{className:"text-green-600",children:[l.amount.toLocaleString(),"đ"]})]},b))}):e.jsx("span",{className:"text-gray-500",children:"-"})},{title:"Khoản khấu trừ",dataIndex:"deductions",key:"deductions",render:a=>a.length>0?e.jsx("div",{className:"flex flex-col gap-1 bg-red-50 p-2 rounded-md",children:a.map((l,b)=>e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{className:"font-medium",children:l.name}),e.jsxs("span",{children:["- ",l.amount.toLocaleString(),"đ"]})]},b))}):e.jsx("span",{className:"text-gray-500",children:"-"})},{title:"Tổng lương nhận",dataIndex:"totalSalary",key:"totalSalary",align:"right",render:a=>e.jsxs("span",{className:"font-semibold text-lg text-black",children:[Math.ceil(a).toLocaleString(),"đ"]})},{title:"Ghi chú",dataIndex:"note",key:"note",render:a=>a?e.jsx(X,{title:a,children:e.jsx("span",{className:"truncate block max-w-[200px]",children:a})}):"-"}],ae=({editingSalary:t,isModalOpenEdit:j,setIsModalOpenEdit:f,fetchSalaries:a})=>{var I;const[l]=r.useForm(),b=s=>{const n=s||l.getFieldsValue(),c=t.daySalary.reduce((y,i)=>y+Number((i==null?void 0:i.salary)||0),0),m=n.allowances||[],o=n.bonuses||[],d=n.deductions||[],u=m.reduce((y,i)=>y+Number((i==null?void 0:i.amount)||0),0),p=o.reduce((y,i)=>y+Number((i==null?void 0:i.amount)||0),0),g=d.reduce((y,i)=>y+Number((i==null?void 0:i.amount)||0),0);return(c+u+p-g).toFixed(2)};x.useEffect(()=>{if(t){const s={...t,periodStart:t.periodStart?C(t.periodStart):null,periodEnd:t.periodEnd?C(t.periodEnd):null,paymentDate:t.paymentDate?C(t.paymentDate):null};l.setFieldsValue(s),setTimeout(()=>{const n=b(s);l.setFieldsValue({totalSalary:n})},0)}},[t,l]);const S=()=>{l.resetFields(),f(!1)},k=async()=>{try{const s=await l.validateFields(),n={allowances:s.allowances,baseSalary:s.baseSalary,bonuses:s.bonuses,deductions:s.deductions,totalSalary:s.totalSalary,note:s.note},c=t==null?void 0:t._id;if((await A(c,n)).success===!0)L.success({content:"Update successfully",key:"salaryUpdate",duration:2}),a(),f(!1);else throw new Error("Cập nhật thất bại")}catch(s){console.error("Lỗi khi cập nhật:",s),L.error({content:"Update failed, please try again!",key:"salaryUpdate",duration:2})}},w=s=>{t.daySalary.reduce((c,m)=>c+Number((m==null?void 0:m.salary)||0),0);const n={...l.getFieldsValue(),...s};if("allowances"in s||"bonuses"in s||"deductions"in s){const c=b(n);l.setFieldsValue({totalSalary:c})}};return x.useEffect(()=>{j&&t&&l.setFieldsValue({allowances:t.allowances,baseSalary:t.baseSalary,bonuses:t.bonuses,deductions:t.deductions,note:t.note,totalSalary:t.totalSalary})},[j,t,l]),e.jsx(Y,{title:"Cập nhật bảng lương",open:j,onOk:k,onCancel:S,okButtonProps:{style:{backgroundColor:"black",color:"white"}},okText:"Cập nhật",cancelText:"Hủy",width:800,children:e.jsxs(r,{form:l,layout:"vertical",onValuesChange:w,children:[e.jsx(r.Item,{name:"employeeId",label:"Nhân viên:",rules:[{required:!0,message:"Please select an employee"}],children:e.jsx("a",{className:"text-black font-medium text-2xl",children:((I=l.getFieldValue("employeeId"))==null?void 0:I.fullName)||"No employee selected"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r.Item,{name:"month",label:"Tháng",rules:[{required:!0,message:"Please select a month"}],children:e.jsx(h,{type:"number",min:1,max:12,className:"w-full",disabled:!0})}),e.jsx(r.Item,{name:"year",label:"Năm",rules:[{required:!0,message:"Please select a year"}],children:e.jsx(h,{type:"number",className:"w-full",disabled:!0})})]}),e.jsx(r.Item,{name:"baseSalary",label:"Lương cơ bản",rules:[{required:!0,message:"Please enter a base salary"}],children:e.jsx(h,{type:"number",className:"w-full",disabled:!0})})]}),e.jsx(r.Item,{name:"totalSalary",label:"Tổng lương nhận được",children:e.jsx(h,{disabled:!0})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(r.Item,{name:"periodStart",label:"Ngày bắt đầu",rules:[{required:!0,message:"Please select a period start date"}],className:"w-full",children:e.jsx(T,{className:"w-full",disabled:!0})}),e.jsx(r.Item,{name:"periodEnd",label:"Ngày kết thúc",rules:[{required:!0,message:"Please select a period end date"}],className:"w-full",children:e.jsx(T,{className:"w-full",disabled:!0})}),e.jsx(r.Item,{name:"paymentDate",label:"Ngày thanh toán",className:"w-full",rules:[{required:!0,message:"Please select a payment date"}],children:e.jsx(T,{className:"w-full",disabled:!0})})]}),e.jsx(r.List,{name:"allowances",children:(s,{add:n,remove:c})=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Phụ cấp"}),e.jsx(N,{type:"default",variant:"solid",color:"default",icon:e.jsx(D,{}),onClick:()=>n(),className:"flex items-center",children:"Thêm phụ cấp"})]}),s.map(({key:m,name:o,...d})=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center mb-4 p-4 border border-gray-200 rounded bg-gray-50",children:[e.jsx(r.Item,{...d,name:[o,"name"],label:"Tên phụ cấp",rules:[{required:!0,message:"Please enter allowance name"}],className:"mb-0",children:e.jsx(h,{})}),e.jsx(r.Item,{...d,name:[o,"amount"],label:"Số tiền",rules:[{required:!0,message:"Please enter amount"}],className:"mb-0",children:e.jsx(h,{type:"number"})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{danger:!0,icon:e.jsx(R,{}),onClick:()=>c(o),className:"flex items-center",children:"Xóa"})})]},m)),s.length===0&&e.jsx("div",{className:"text-center p-6 border border-dashed border-gray-300 rounded bg-gray-50",children:e.jsx("p",{className:"text-gray-500",children:'No allowances yet. Click "Add Allowance" to start'})})]})}),e.jsx(r.List,{name:"bonuses",children:(s,{add:n,remove:c})=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Thưởng"}),e.jsx(N,{type:"default",variant:"solid",color:"default",icon:e.jsx(D,{}),onClick:()=>n(),className:"flex items-center",children:"Thêm khoản thưởng"})]}),s.map(({key:m,name:o,...d})=>e.jsxs("div",{className:"grid grid-cols-4 gap-4 items-center mb-4 p-4 border border-gray-200 rounded bg-gray-50",children:[e.jsx(r.Item,{...d,name:[o,"name"],label:"Tên khoan thưởng",rules:[{required:!0,message:"Please enter bonus name"}],className:"mb-0",children:e.jsx(h,{})}),e.jsx(r.Item,{...d,name:[o,"amount"],label:"Số tiền",rules:[{required:!0,message:"Please enter amount"}],className:"mb-0",children:e.jsx(h,{type:"number"})}),e.jsx(r.Item,{...d,name:[o,"reason"],label:"Lý do",className:"mb-0",children:e.jsx(h,{})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{danger:!0,icon:e.jsx(R,{}),onClick:()=>c(o),className:"flex items-center",children:"Xóa"})})]},m)),s.length===0&&e.jsx("div",{className:"text-center p-6 border border-dashed border-gray-300 rounded bg-gray-50",children:e.jsx("p",{className:"text-gray-500",children:'No bonuses yet. Click "Add Bonus" to start'})})]})}),e.jsx(r.List,{name:"deductions",children:(s,{add:n,remove:c})=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Khấu trừ"}),e.jsx(N,{type:"default",variant:"solid",color:"default",icon:e.jsx(D,{}),onClick:()=>n(),className:"flex items-center",children:"Thêm khoản khấu trừ"})]}),s.map(({key:m,name:o,...d})=>e.jsxs("div",{className:"grid grid-cols-4 gap-4 items-center mb-4 p-4 border border-gray-200 rounded bg-gray-50",children:[e.jsx(r.Item,{...d,name:[o,"name"],label:"Tên khoản khấu trừ",rules:[{required:!0,message:"Please enter deduction name"}],className:"mb-0",children:e.jsx(h,{})}),e.jsx(r.Item,{...d,name:[o,"amount"],label:"Số tiền",rules:[{required:!0,message:"Please enter amount"}],className:"mb-0",children:e.jsx(h,{type:"number"})}),e.jsx(r.Item,{...d,name:[o,"reason"],label:"Lý do",className:"mb-0",children:e.jsx(h,{})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{danger:!0,icon:e.jsx(R,{}),onClick:()=>c(o),className:"flex items-center",children:"Xóa"})})]},m)),s.length===0&&e.jsx("div",{className:"text-center p-6 border border-dashed border-gray-300 rounded bg-gray-50",children:e.jsx("p",{className:"text-gray-500",children:'No deductions yet. Click "Add Deduction" to start'})})]})}),e.jsx(r.Item,{name:"note",label:"Ghi chú",children:e.jsx(h.TextArea,{})})]})})};function ge(){const[t,j]=x.useState([]),[f,a]=x.useState(!0),[l,b]=x.useState(null),[S,k]=x.useState(!1),[w,I]=x.useState(""),[s,n]=x.useState(null),[c,m]=x.useState(null),o=F(u=>{var p,g;return(g=(p=u==null?void 0:u.auth)==null?void 0:p.user)==null?void 0:g.role}),d=async()=>{try{const u=await H({search:w,month:s,year:c});console.log(u),u.success?(a(!1),j(u.data)):a(!0)}catch{console.error("Failed to fetch salaries")}};return x.useEffect(()=>{d()},[w,s,c]),e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mt-5",children:e.jsxs(P,{className:"mt-4",children:[e.jsx(P.Compact,{size:"middle",style:{width:"400px"},children:e.jsx(h,{addonBefore:e.jsx(G,{}),placeholder:"Tìm kiếm",value:w,onChange:u=>I(u.target.value)})}),e.jsxs(v,{placeholder:"Month",value:s,onChange:n,style:{width:120},allowClear:!0,children:[e.jsx(v.Option,{value:null,children:"Chọn Tháng"}),Array.from({length:12},(u,p)=>e.jsx(v.Option,{value:p+1,children:p+1},p+1))]}),e.jsxs(v,{placeholder:"Year",value:c,onChange:m,style:{width:120},allowClear:!0,children:[e.jsx(v.Option,{value:null,children:"Chọn Năm"}),Array.from({length:5},(u,p)=>{const g=new Date().getFullYear();return e.jsx(v.Option,{value:g-p,children:g-p},g-p)})]})]})}),e.jsx(O,{dataSource:t,columns:se(b,k,o),className:"mt-10",scroll:{x:"max-content"}}),e.jsx(ae,{editingSalary:l,isModalOpenEdit:S,setIsModalOpenEdit:k,fetchSalaries:d})]})}export{ge as default};
